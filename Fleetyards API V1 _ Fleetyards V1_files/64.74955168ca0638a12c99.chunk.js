(self.webpackJsonp=self.webpackJsonp||[]).push([[64],{2029:function(t,e,n){"use strict";n.r(e),n.d(e,"ProjectRegistry",(function(){return d})),n.d(e,"getProjectRegistry",(function(){return l}));var r=n(402),s=n(2236),a=n(84),o=n(2209),c=n(13);const i=new WeakMap;const u=(t,e=0,n)=>{const r=function(t){let e=i.get(t);return void 0===e&&(e=new Map,i.set(t,e)),e}(t);return(...s)=>{let a=r.get(s[0]);void 0===a&&(a=Object(c.debounce)(t,e,n),r.set(s[0],a)),a(...s)}};class d extends r.EventEmitter{constructor(){super(...arguments),this.appCache=Object(o.a)(),this._reactions=new r.DisposableCollection,this._projectUpdated=u((t,e)=>{this.emit("updated",e)},1500),this.upsertProject=Object(a.h)((function*(t){yield this.ensureActivated();const e=this.appCache.projects[t.id],n=Object.assign(Object.assign({},e),t);return(null==e?void 0:e.cwd)&&(n.cwd=e.cwd),this.appCache.projects[t.id]=n,e?this.emit("updated",n):this.emit("added",n),t})).bind(this),this.deleteProject=Object(a.h)((function*(t){yield this.ensureActivated();const e=this.appCache.projects[t];delete this.appCache.projects[t],console.log(`deleting database SL.${t}...`);try{yield Promise.race([Object(s.a)("SL."+t),new Promise((t,e)=>{setTimeout(()=>e(new Error("Project failed to remove within a second")),1e3)})])}finally{return console.log("deleted"),this.emit("removed",Object(a.u)(e)),e}})).bind(this)}async ensureActivated(){var t;"deactivated"===this.appCache.state?await this.appCache.activate():"isActivating"===this.appCache.state&&await new Promise(t=>Object(a.w)(()=>"activated"===this.appCache.state,()=>t())),null===(t=this._reactions)||void 0===t||t.dispose(),this._reactions.push(Object(r.createDisposable)(Object(a.q)(this.appCache.projects,t=>{"update"===t.type&&this._projectUpdated(String(t.name),Object(a.u)(t.object[t.name]))})))}async listProjects(){return await this.ensureActivated(),Object.values(this.appCache.projects||{})}async migrateToWebProject(t,e,r,s){const{migrateToWebProject:a}=await Promise.all([n.e(0),n.e(4),n.e(1),n.e(2),n.e(5),n.e(3),n.e(12)]).then(n.bind(null,2907));await this.ensureActivated();return a(this.appCache.projects[t],e,r,s)}async downloadZipOfProject(t){const{downloadZipFile:e}=await Promise.all([n.e(0),n.e(4),n.e(1),n.e(2),n.e(5),n.e(3),n.e(12)]).then(n.bind(null,2907));await this.ensureActivated();const r=this.appCache.projects[t];await e(r)}}let p;const l=()=>(p||(p=new d),p)},2070:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(403);let s=Object(r.getReporter)();if(!s)throw new Error("Missing a @stoplight/reporter");const a=s},2115:function(t,e,n){"use strict";function r(t){return null!=t&&"object"==typeof t}function s(t){return"function"!=typeof t&&!r(t)}function a(t){return null!=t}n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a}))},2145:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(2070);const s=(t,e)=>{const n=setInterval(async()=>{try{await t()}catch(t){t.extra={trigger:"createDisposableInterval"},r.a.error(t)}},e),s={dispose:()=>{clearInterval(n),s.dispose=()=>{}}};return s}},2146:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(18),s=n(402),a=n(84);class o extends s.Activatable{constructor(){super(...arguments),this.__state="deactivated"}get _state(){return this.__state}set _state(t){this.__state=t}}Object(r.__decorate)([a.p,Object(r.__metadata)("design:type",Object)],o.prototype,"__state",void 0),Object(r.__decorate)([a.f,Object(r.__metadata)("design:type",Object),Object(r.__metadata)("design:paramtypes",[Object])],o.prototype,"_state",null)},2209:function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var r=n(18),s=n(73),a=n(402),o=n(84),c=n(2145),i=n(2115),u=n(2146);function d(){const t=Object(s.safeParse)(localStorage.SL);return{config:Object(i.b)(null==t?void 0:t.config)?t.config:{},projects:Object(i.b)(null==t?void 0:t.projects)?t.projects:{}}}class p extends u.a{constructor(){super(),this._activeDisposables=new a.DisposableCollection,this.doActivate=Object(o.h)(function*(){yield async function(){if(localStorage.SL)return;let t;({openDB:t}=await n.e(13).then(n.bind(null,2324)));const e=await t("SL",1,{upgrade(t,e,n){1===n&&(t.createObjectStore("config"),t.createObjectStore("projects"))}}),r=await e.transaction(["config","projects"],"readwrite"),a={config:{},projects:{}};for(const t of r.objectStoreNames){const e=await r.objectStore(t),n=await e.getAllKeys();await Promise.allSettled(n.map(async n=>{a[t][String(n)]=await e.get(n)}))}return localStorage.SL=Object(s.safeStringify)(a),void Promise.allSettled(Array.from(r.objectStoreNames).map(async t=>{const e=await r.objectStore(t);await e.clear()})).catch(t=>{console.error("Failed to clean idb stores",t)})}(),this._storage=d(),this._activeDisposables=new a.DisposableCollection,this._activeDisposables.push(Object(c.a)(this._saveStorage,5e3))}.bind(this)),this._saveStorage=()=>{localStorage.SL=Object(s.stringify)(this._storage)},this._storage=d()}get config(){return this._storage.config}get projects(){return this._storage.projects}async doDeactivate(){this._saveStorage(),this._activeDisposables.dispose()}}let l;Object(r.__decorate)([o.p,Object(r.__metadata)("design:type",Object)],p.prototype,"_storage",void 0),Object(r.__decorate)([o.f,Object(r.__metadata)("design:type",Object),Object(r.__metadata)("design:paramtypes",[])],p.prototype,"config",null),Object(r.__decorate)([o.f,Object(r.__metadata)("design:type",Object),Object(r.__metadata)("design:paramtypes",[])],p.prototype,"projects",null);const b=()=>(l||(l=new p),l)},2236:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));let r,s;const a=new WeakMap,o=new WeakMap,c=new WeakMap,i=new WeakMap,u=new WeakMap;let d={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return o.get(t);if("objectStoreNames"===e)return t.objectStoreNames||c.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return b(t[e])},has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function p(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(h(this),e),b(a.get(this))}:function(...e){return b(t.apply(h(this),e))}:function(e,...n){const r=t.call(h(this),e,...n);return c.set(r,e.sort?e.sort():[e]),b(r)}}function l(t){return"function"==typeof t?p(t):(t instanceof IDBTransaction&&function(t){if(o.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{e(),r()},a=()=>{n(t.error),r()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});o.set(t,e)}(t),e=t,(r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,d):t);var e}function b(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{e(b(t.result)),r()},a=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",a)});return e.then(e=>{e instanceof IDBCursor&&a.set(e,t)}).catch(()=>{}),u.set(e,t),e}(t);if(i.has(t))return i.get(t);const e=l(t);return e!==t&&(i.set(t,e),u.set(e,t)),e}const h=t=>u.get(t);function f(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",()=>e()),b(n).then(()=>{})}const j=["get","getKey","getAll","getAllKeys","count"],g=["put","add","delete","clear"],v=new Map;function y(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(v.get(e))return v.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=g.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!j.includes(n))return;const a=async function(t,...e){const a=this.transaction(t,s?"readwrite":"readonly");let o=a.store;r&&(o=o.index(e.shift()));const c=o[n](...e);return s&&await a.done,c};return v.set(e,a),a}d=(t=>({get:(e,n,r)=>y(e,n)||t.get(e,n,r),has:(e,n)=>!!y(e,n)||t.has(e,n)}))(d)}}]);